---
title: Building a Headless Browser in Go
info: |
  ## Slidev Starter Template
  Presentation slides for developers.

drawings:
  persist: true

theme: neversink
---

# Building a Headless Browser in Go

Or: How I Learned To Stop Worrying And Love HTML

by **Peter Str√∏iman**

::note::

---
layout: top-title
color: slate
---

::title::

# About me

::content::

- Coding since the age of 8
- Professional coder since 1997
- Passionate about Test-Driven Development
- Fine Arts Photographer

- [github.com/gost-dom](https://github.com/gost-dom)
- [github.com/stroiman](https://github.com/stroiman)
- [linkedin/in/stroiman](https://linkedin.com/in/stroiman)
- [stroiman.photography](https://stroiman.photography)

---
src: ./pages/intro.md
---

# In between

---
src: ./pages/htmx.md
---

# Verifying Behaviour?

Application behaviour becomes a choreography between

- HTML Elements with specific attributes defined
- The hypermedia framework parsing those attributes
- HTTP Response headers and body on generated responses
- Generated by handlers written for that framework

---
src: ./pages/building.md
---


## Embedding V8 in Go

- v8go existed as a project
  - Not all v8 features were supported.

## Mistakes

- Using V8

---
src: ./pages/login-page.md
---

# Example

```go
func CreateRootHandler() *http.Handler {
}
```

```go
func TestIndexPage(t *testing.T) {
    browser := browser.New(
        browser.WithHandler(CreateRootHandler()),
        browser.WithContext(t.Context()), // Optional
    )
    window, err := browser.Open("https://example.com/")
    assert.NoError(t, err)
    title, err := window.Document().QuerySelector("h1")
    assert.True(t, error)
    assert.NotNil(t, title)
    assert.Equal(t, "Hello, World!", title.TextContent())
}
```

---
layout: top-title
color: slate
---

:: title ::

# Example: A session-based login page

:: content ::

Use tests to drive the implementation of _behaviour_ in the _UI Layer_

- Login session handling
- Redirecting to login when requesting protected resources
- Return to requested resource on successful login

## Strategy

Mock the code validating credentials; Not UI responsibility.

<AdmonitionType type="warning" title="Beware">
This is not a guide to implementing session-based authentication. Many security
concerns are not covered here.
</AdmonitionType>

---

# Coupling to accessibility attributes

Shaman library 

```go
func TestIndexPage(t *testing.T) {

}
```

---
layout: top-title
---

Priorities have been supporting basic HTMX applications. 

:: title ::

# Features

:: content ::

- Implements most relevant parts of the core browser APIs
  - DOM/HTML DOM
  - XMLHttpRequest
  - url
  - UI Events
- Executes JavaScript using V8
  - JavaScript engine is pluggable.
  - Goja support experimental - pure Go JavaScript engine
- 100% deterministic code execution
  - No erratic tests
- Time Travel 
  - E.g., for testing throttling and debounce2

---
layout: top-title
---

:: title ::

# Future Vision

<v-click>

Different strategies can be used for different testing needs. For geolocation:

</v-click>

- One implement could return a single point.
- Another could replay a GPX track
  - E.g., your application implements geofencing in the UI.

:: content ::

Gost-DOM provides core browser functionalities. Plugins can support more web
APIs. E.g.

- Local storage/session storage/DB
- Geolocation


---
layout: top-title
---

Donations are also welcome. 

<v-click>VAT invoices can be provided</v-click>

:: title ::

# How to Contribute

:: content ::

- Features.
- Feedback
- Test
- Spread the word
- Support for new web APIs
- Build a web site

---

# Inspiration

- [Testing Library](https://testing-library.com/)
  - Writing tests coupled to accessibility 
- [jscom](https://github.com/jsdom/jsdom)
- Unmaintained
  - [Zombie](https://zombie.js.org/)
  - [PhantomJS](https://phantomjs.org/)
  -
