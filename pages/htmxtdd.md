---
layout: section
color: slate
---

# Test-Driven Development with HTMX

---
layout: top-title
color: slate
---

:: title ::

# Verifying Behaviour?

:: content ::

<div class="ns-c-tight">

The behaviour in the _UI layer_ when submitting a _login form_ entails:

- Accepting and validating form input.
- Convert form data to a _use case operation_
- Present the outcome of the operation to the user
  - An error is displayed to the user
  - A success navitages to a new page
  - AND adds a new history entry
- Handling sessions and session cookies.


</div>

---
layout: top-title
color: slate
---

:: title ::

# Behaviour in HTMX

:: content ::

For hypermedia libraries, application behaviour results from a choreography of

- HTML Elements with specific attributes defined
- The hypermedia framework parsing those attributes
- HTTP Responses containing only HTML fragments
  - Generated by handlers written specifically for the hypermedia library

Behaviour as a whole can only be tested in a browser-like environment.

---
layout: top-title
color: slate
---

:: title ::

# Goal

:: content ::

A tool that can provide _relevant_ feedback when implementing UI behaviour

<div class="ns-c-tight">
<v-clicks>


- Implement a browser-like environment implementing essential Web APIs to be useful.
- Provide a JavaScript environment, exposing the the APIs to JS code.
- Expose the same web APIs to Go.
  - Verify and inspect the DOM using the APIs I already know
- Simulate the passing of time (testing throttling behaviour)
- Automatic fast forward until all event loop actions have completed.
- Allow tests code to 
  - _mock at the layer boundary_ (it's UI behaviour being tested)
  - reuse production to express behaviour using the domain model

</v-clicks>
</div>

<v-click>

Ergo, it **must** be written in the same language as the back-end code.

</v-click>

---
layout: top-title
color: slate
---

:: title ::

# Goal Accomplished

:: content ::

<v-clicks>

- Basic HTMX functionality works
- DataStar support in progress
- Embeds a V8 for JavaScript support
- Typical test execution time ~ 10-30 milliseconds.

Shortcuts taken

- Use polyfills whenever possible; optimize later.
- XPath implementation is based on jsdom
- Text Encoder/Decoder based on FastestSmallestTextEncoderDecoder
- Use existing Go CSS selector library

Bonus: Consume the `http.Handler` directly to bypass the TCP stack.

</v-clicks>

<StickyNote class="ns-c-tight" title="Optimazation possible" v-drag="[501,162,240,133,-14]">

- caching pre-compiled scripts.
- Parser performs unnecessary steps.
- Write native CSS selector.

</StickyNote>
